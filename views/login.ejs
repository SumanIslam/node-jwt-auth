<%- include('partials/header'); -%>

<form>
	<h2>Log In</h2>
	<label for="email">Email</label>
	<input type="text" name="email" required />
	<div class="email error"></div>
	<label for="password">Password</label>
	<input type="password" name="password" required />
	<div class="password error"></div>
	<button>Log In</button>
</form>

<script>
	const form = document.querySelector("form");
	const emailError = document.querySelector(".email.error");
	const passwordError = document.querySelector(".password.error");

	form.addEventListener("submit", async (e) => {
		e.preventDefault();

		// reset errors for every request
		emailError.textContent = "";
		passwordError.textContent = "";

		// form.email.value = '';
		// form.password.value = '';

		// get the values
		const email = form.email.value;
		const password = form.password.value;

		try {
			const res = await fetch("/auth/login", {
				method: "POST",
				body: JSON.stringify({
					email,
					password,
				}),
				headers: { "Content-Type": "application/json" },
			});

			const data = await res.json();

			if (data.error) {
        const emailErr = data.error.includes("Email");
        const passwordErr = data.error.includes("password");
				if (emailErr) {
					emailError.textContent = data.error;
				}
				if (passwordErr) {
					passwordError.textContent = data.error;
				}
			}

			if (data.user) {
				location.assign("/");
			}
		} catch (err) {
			console.log(err);
		}
	});
</script>

<%- include('partials/footer'); -%>
